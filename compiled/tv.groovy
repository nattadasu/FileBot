{def XV = { System.getProperty(it) };def VnA = XV("os.name").toLowerCase().contains("windows");def mz = XV("user.name");def JJ = "/run/media/${mz}";def Sg = VnA ? "H:/" : "$JJ/Videos";def Tl = [[aL: "Books", xS: "F:/", ILt: "$JJ/Books"],[aL: "Data", xS: "D:/", ILt: "$JJ/Data"],[aL: "Games", xS: "G:/", ILt: "$JJ/Games"],[aL: "Music", xS: "E:/", ILt: "$JJ/Music"],[aL: "Videos", xS: "H:/", ILt: "$JJ/Videos"]];def ilH = (Tl.collect { it[VnA ? "xS" : "ILt"] as File }.sort { JqH, sV ->  JqH.exists() <=> sV.exists() ?: JqH.diskSpace <=> sV.diskSpace }).last();def MNz = Sg ?: ilH;"$MNz/"}{"Videos/"}{def FB = ["boys' love (bl)", "gay theme", "yaoi", "yuri", "lesbian", "hentai","sex", "lgbt", "explicit", "adult animation", "adult content","nudity", "animefesta"];def MvB = "TheMovieDB::TV";def vHV = [[ 74180, MvB],[ 93821, MvB],[ 95897, MvB],[220118, MvB],[249891, MvB],[271026, MvB]];def jvr = [[236530, MvB]];def dML = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def jpf = dML == "IMDb" ? "tt${id}" : id;def jO = any { info.adult } { false };def tx = vHV.find { it[0] == jpf && it[1] == dML } != null;def MP = jvr.find { it[0] == jpf && it[1] == dML } != null;def iDQ = info.Keywords.findAll { it in FB } || tx || jO;iDQ = MP ? false : iDQ;iDQ ? "R18+ " : ""}{def bk = ["CN", "JP", "KR", "KP", "TW", "HK"];def Cex = ["aeni", "donghua", "anime"];def gH = any {anime} || info.Keywords.findAll { it in Cex } || (bk.contains(country) && genres =~ /Animation/);gH ? "Anime/" : "TV Series/"}{def MvB = "TheMovieDB::TV";def jf = [[GO: 213830, ili: "I Was Reincarnated as the 7th Prince", ISc: MvB],[GO: 232230, ili: "Lord of the Mysteries", ISc: MvB],[GO: 238460, ili: "Sumikko Gurashi Sorairo no Mainichi Tokubetsu-hen", ISc: MvB],[GO: 270660, ili: "Pochars", ISc: MvB],[GO: 277581, ili: "Dekin no Mogura", ISc: MvB],[GO: 280038, ili: "Apocalypse Bringer Mynoghra", ISc: MvB],[GO: 280405, ili: "Fudanshi Shoukan", ISc: MvB],[GO: 285260, ili: "Kaijyu Sekai Seifuku", ISc: MvB],[GO: 295625, ili: "Marie Antoinette ni Tensei Shita", ISc: MvB],[GO: 296047, ili: "Shuukan Ranobe Anime", ISc: MvB],[GO: 296319, ili: "Tomica Heroes Job Labor (TV)", ISc: MvB]];def dML = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def jpf = dML == "IMDb" ? "tt${id}" : id;def MRk = n;jf.each {if (it.GO == jpf && it.ISc == dML) {MRk = it.ili}};def epq = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def jd = MRk.replaceAll(epq.collect { "\\" + it }.join('|'), '');jd = jd.replaceAll(/(\s|\.)*$/, '');jd}{def MvB = "TheMovieDB::TV";def nVD = [[ 95897, MvB],[123542, MvB],[239779, MvB],[257162, MvB],[259140, MvB],[276204, MvB]];def Qk = nVD.find { it[0] == id && it[1] == info.database } != null;def HZ = ["TheMovieDB::TV": "tmdbid","AniDB": "anidbid","TheTVDB": "tvdbid","TVmaze": "tvmazeid"];def fZU = HZ[info.database];Qk ? " ($y) [${fZU}-${id}]" : ""}{"/"}{episode.special ? 'Specials' : 'Season '+s}{def epq = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def jd = sn.replaceAll(epq.collect { "\\" + it }.join('|'), '_');def WRF = n.replaceAll(epq.collect { "\\" + it }.join('|'), '_');def nbH = jd.contains(WRF) ? "" : jd;nbH == 'Season '+ s || nbH == 'Series '+ s ? "" : nbH ? " - " + nbH : ""}{"/"}{def yb = ["Alqanime","BlackLuster","darkflux","It's Anime","Kuramanime","NanDesuKa","ToonsHub","Tsundere-Raws","S1PH3R","Samehadaku"];def LHh = yb.find { Ilv ->  fn.lower().contains(Ilv.lower()) } ?: "";def DT = any {LHh} {(fn =~ /^\[(.*?)\]/)[0][1]} {group} {""};DT ? "[$DT] " : ""}{def MvB = "TheMovieDB::TV";def jf = [[GO: 213830, ili: "I Was Reincarnated as the 7th Prince", ISc: MvB],[GO: 232230, ili: "Lord of the Mysteries", ISc: MvB],[GO: 238460, ili: "Sumikko Gurashi Sorairo no Mainichi Tokubetsu-hen", ISc: MvB],[GO: 270660, ili: "Pochars", ISc: MvB],[GO: 277581, ili: "Dekin no Mogura", ISc: MvB],[GO: 280038, ili: "Apocalypse Bringer Mynoghra", ISc: MvB],[GO: 280405, ili: "Fudanshi Shoukan", ISc: MvB],[GO: 285260, ili: "Kaijyu Sekai Seifuku", ISc: MvB],[GO: 295625, ili: "Marie Antoinette ni Tensei Shita", ISc: MvB],[GO: 296047, ili: "Shuukan Ranobe Anime", ISc: MvB],[GO: 296319, ili: "Tomica Heroes Job Labor (TV)", ISc: MvB]];def dML = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def jpf = dML == "IMDb" ? "tt${id}" : id;def MRk = n;jf.each {if (it.GO == jpf && it.ISc == dML) {MRk = it.ili}};def epq = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def jd = MRk.replaceAll(epq.collect { "\\" + it }.join('|'), '');jd = jd.replaceAll(/(\s|\.)*$/, '');jd}{" - "}{s00e00}{def epq = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def jd = t.replaceAll(epq.collect { "\\" + it }.join('|'), '_');jd = jd.length() > 100 ? " " : " - $jd ";def cDo = any { e } { special };def vPG = "Episode $cDo";def FK = jd.contains(vPG) ? '' : jd;special ? FK : ''}{" ["}{def De = [["YTB", "YT.WEB-DL", "YOUTUBE"],["ABEMA", "ABEMATV"],["ADN"],["BILI", "B-Global", "BiliIntl"],["BSITE", "BILICN"],["CMIC", "COOLMIC"],["CTHP"],["FOD"],["HIDIVE", "HIDI.WEB-DL"],["IQIYI", "IQ.WEB-DL"],["JFFP"],["LFTL", "LAFTEL"],["MDON", "MANGADON"],["MW.WEB-DL"],["NF.WEB-DL", "NF WEB"],["OVEIL", "OV.WEB-DL", "OceanVeil"],["SHAHID"],["TVER"],["UNEXT"],["VIDIO"],["VIU"],["WETV"],["INSTA", "INSTAGRAM"],["ANIMENOTANE"],["TWTR"]];def Hwd = ["ASW", "Judas", "JRx7", "EMBER", "GuodongSubs", "SAMEHADAKU"];def LK = ["DB"];def IkL = ["Ruri-Saizen"];def Eox = ["Erai-raws", "SubsPlease"];def jRs = any {(fn =~ /^\[(.*?)\]/)[0][1]} {""};def JI = any {def uda = De.find { IeB ->  IeB.find { QeU ->  fn.lower().contains(QeU.lower()) } }[0];uda = uda.replace(".WEB-DL", "");if (fn.contains("WEBRip")) {uda = uda.replace(".WEBRip", "");uda = uda + ".WEBRip"} else {uda = uda + ".WEB-DL"};uda} {source} {Hwd.find { zvQ ->  group == zvQ || jRs == zvQ } ? "WEBRip" : ""} {LK.find { zvQ ->  group == zvQ || jRs == zvQ } ? "BDRip" : ""} {IkL.find { zvQ ->  group == g__ || jRs == g__} ? "HDTVRip" : ""} {def Kp = Eox.find { on ->  group == on || jRs == on} ? "WEB-DL" : "";(source == "Erai-raws" && vcf.upper() == "HEVC") ? "WEBRip" : Kp} {vs} {""};JI ? "$JI " : ""}{def CR = bitdepth ? " ${bitdepth}bit" : "";"$resolution $vcf $CR, $ac"}{" "}{af.format(8: 'DD+ 7.1',7: '6.1',6: 'DD 5.1',5: '5.0',3: '2.1',2: '2.0',1: '1.0')}{def AZ = any { audioLanguages.size() } { 0 };def xU = AZ > 2 ? " MULTi-AUD" : AZ > 1 ? " DUAL-AUD" : "";def eM = AZ > 5 ? audioLanguages.take(5) : audioLanguages;def _G = audioLanguages.any { it.ISO3B == language.ISO3B } ? "" : " DUBBED";xU = AZ == 1 && audioLanguages.any { it.ISO3B == "und" } ? "" : "$xU$_G";xU ? xU + eM.ISO2.joining(" ", " (", "").upper() + (AZ > 5 ? " ...)" : ")") : ""}{def hxy = text.language.collect {['zh-Hans': 'ZH-S','zh-Hant': 'ZH-T','ar-001': 'AR-MSA'].get(it,it).toUpperCase()}.unique();def FY = any { hxy.size() } { 0 };def xU = FY > 2 ? ", MULTi" : FY > 1 ? ", DUAL" : FY == 1 ? ", SUB" : null;def eM = FY > 5 ? hxy.take(5) : hxy;xU ? xU + eM.joining(" ", " (", "").upper() + (FY > 6 ? " ...)" : ")") : ""}{"]["}{crc32.upper()}{"]"}{if (f.subtitle) {def Wv = ["name": "." + lang.name,"iso3b": "." + lang.ISO3B,"iso3": "." +lang.ISO3,"iso2": "." + lang.ISO2];def Ip = subt;Wv.values().each { dv -> if (Ip.contains(dv)) {Ip = Ip.replace(dv, "")}};Wv.iso3b + Ip}}{f.image ? "-thumb" : ""}