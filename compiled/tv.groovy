{def jg = { System.getProperty(it) };def TYd = jg("os.name").toLowerCase().contains("windows");def Mi = jg("user.name");def IHg = "/run/media/${Mi}";def IQY = TYd ? "H:/" : "$IHg/Videos";def u_B = [[H_: "Books", yVo: "F:/", tt: "$IHg/Books"],[H_: "Data", yVo: "D:/", tt: "$IHg/Data"],[H_: "Games", yVo: "G:/", tt: "$IHg/Games"],[H_: "Music", yVo: "E:/", tt: "$IHg/Music"],[H_: "Videos", yVo: "H:/", tt: "$IHg/Videos"]];def cm = (u_B.collect { it[TYd ? "yVo" : "tt"] as File }.sort { Jmm, t_o ->  Jmm.exists() <=> t_o.exists() ?: Jmm.diskSpace <=> t_o.diskSpace }).last();def sDl = IQY ?: cm;"$sDl/"}{"Videos/"}{def DC = ["boys' love (bl)", "gay theme", "yaoi", "yuri", "lesbian", "hentai","sex", "lgbt", "explicit", "adult animation", "adult content","nudity", "animefesta"];def yr = "TheMovieDB::TV";def _Hh = [[ 74180, yr],[ 93821, yr],[ 95897, yr],[220118, yr],[249891, yr],[271026, yr]];def TZ = [[236530, yr]];def LZP = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def DjH = LZP == "IMDb" ? "tt${id}" : id;def va = any { info.adult } { false };def lT = _Hh.find { it[0] == DjH && it[1] == LZP } != null;def Vsk = TZ.find { it[0] == DjH && it[1] == LZP } != null;def Oj = info.Keywords.findAll { it in DC } || lT || va;Oj = Vsk ? false : Oj;Oj ? "R18+ " : ""}{def szA = ["CN", "JP", "KR", "KP", "TW", "HK"];def Oeh = ["aeni", "donghua", "anime"];def TYE = any {anime} || info.Keywords.findAll { it in Oeh } || (szA.contains(country) && genres =~ /Animation/);TYE ? "Anime/" : "TV Series/"}{def yr = "TheMovieDB::TV";def eO = [[uS: 213830, G_C: "I Was Reincarnated as the 7th Prince", Ro: yr],[uS: 221165, G_C: "Hyakusho Kizoku", Ro: yr],[uS: 236565, G_C: "Hero Without a Class", Ro: yr],[uS: 238460, G_C: "Sumikko Gurashi Sorairo no Mainichi Tokubetsu-hen", Ro: yr],[uS: 262453, G_C: "The Fated Magical Princess", Ro: yr],[uS: 270660, G_C: "Pochars", Ro: yr],[uS: 277581, G_C: "Dekin no Mogura", Ro: yr],[uS: 278635, G_C: "Unlimited Gacha", Ro: yr],[uS: 280038, G_C: "Apocalypse Bringer Mynoghra", Ro: yr],[uS: 280405, G_C: "Fudanshi Shoukan", Ro: yr],[uS: 285260, G_C: "Kaijyu Sekai Seifuku", Ro: yr],[uS: 295625, G_C: "Marie Antoinette ni Tensei Shita", Ro: yr],[uS: 296047, G_C: "Shuukan Ranobe Anime", Ro: yr],[uS: 296319, G_C: "Tomica Heroes Job Labor (TV)", Ro: yr],[uS: 297286, G_C: "Potions Will Save Me", Ro: yr],[uS: 302169, G_C: "Anila and Cocora", Ro: yr]];def LZP = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def DjH = LZP == "IMDb" ? "tt${id}" : id;def DYT = n;eO.each {if (it.uS == DjH && it.Ro == LZP) {DYT = it.G_C}};def _M = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def sd = DYT.replaceAll(_M.collect { "\\" + it }.join('|'), '');sd = sd.replaceAll(/(\s|\.)*$/, '');sd}{def yr = "TheMovieDB::TV";def Xcm = [[ 95897, yr],[123542, yr],[239779, yr],[257162, yr],[259140, yr],[276204, yr]];def ImH = Xcm.find { it[0] == id && it[1] == info.database } != null;def qpl = ["TheMovieDB::TV": "tmdbid","AniDB": "anidbid","TheTVDB": "tvdbid","TVmaze": "tvmazeid"];def cp = qpl[info.database];ImH ? " ($y) [${cp}-${id}]" : ""}{"/"}{episode.special ? 'Specials' : 'Season '+s}{def _M = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def sd = sn.replaceAll(_M.collect { "\\" + it }.join('|'), '_');def USG = n.replaceAll(_M.collect { "\\" + it }.join('|'), '_');def Qg = sd.contains(USG) ? "" : sd;Qg == 'Season '+ s || Qg == 'Series '+ s ? "" : Qg ? " - " + Qg : ""}{"/"}{def Ozd = ["AkiraRIPS","Alqanime","BlackLuster","darkflux","It's Anime","Kuramanime","NanDesuKa","ToonsHub","Tsundere-Raws","S1PH3R","Samehadaku"];def CB = Ozd.find { Csk ->  fn.lower().contains(Csk.lower()) } ?: "";def yB = any {CB} {(fn =~ /^\[(.*?)\]/)[0][1]} {group} {""};yB ? "[$yB] " : ""}{def yr = "TheMovieDB::TV";def eO = [[uS: 213830, G_C: "I Was Reincarnated as the 7th Prince", Ro: yr],[uS: 221165, G_C: "Hyakusho Kizoku", Ro: yr],[uS: 236565, G_C: "Hero Without a Class", Ro: yr],[uS: 238460, G_C: "Sumikko Gurashi Sorairo no Mainichi Tokubetsu-hen", Ro: yr],[uS: 262453, G_C: "The Fated Magical Princess", Ro: yr],[uS: 270660, G_C: "Pochars", Ro: yr],[uS: 277581, G_C: "Dekin no Mogura", Ro: yr],[uS: 278635, G_C: "Unlimited Gacha", Ro: yr],[uS: 280038, G_C: "Apocalypse Bringer Mynoghra", Ro: yr],[uS: 280405, G_C: "Fudanshi Shoukan", Ro: yr],[uS: 285260, G_C: "Kaijyu Sekai Seifuku", Ro: yr],[uS: 295625, G_C: "Marie Antoinette ni Tensei Shita", Ro: yr],[uS: 296047, G_C: "Shuukan Ranobe Anime", Ro: yr],[uS: 296319, G_C: "Tomica Heroes Job Labor (TV)", Ro: yr],[uS: 297286, G_C: "Potions Will Save Me", Ro: yr],[uS: 302169, G_C: "Anila and Cocora", Ro: yr]];def LZP = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def DjH = LZP == "IMDb" ? "tt${id}" : id;def DYT = n;eO.each {if (it.uS == DjH && it.Ro == LZP) {DYT = it.G_C}};def _M = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def sd = DYT.replaceAll(_M.collect { "\\" + it }.join('|'), '');sd = sd.replaceAll(/(\s|\.)*$/, '');sd}{" - "}{s00e00}{def fMj = (fn =~ /(?i)(?<![a-zA-Z])v(\d+)/);fMj ? 'v' + fMj[0][1] : ''}{def _M = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def sd = t.replaceAll(_M.collect { "\\" + it }.join('|'), '_');sd = sd.length() > 100 ? " " : " - $sd ";def NM_ = any { e } { special };def XiX = "Episode $NM_";def KiQ = sd.contains(XiX) ? '' : sd;special ? KiQ : ''}{" ["}{def wSN = [["YTB", "YT.WEB-DL", "YOUTUBE"],["ABEMA", "ABEMATV"],["ADN"],["BILI", "B-Global", "BiliIntl"],["BSITE", "BILICN"],["BUMP"],["CMIC", "COOLMIC"],["CTHP"],["FOD"],["HIDIVE", "HIDI.WEB-DL"],["IQIYI", "IQ.WEB-DL"],["JFFP"],["LFTL", "LAFTEL"],["MDON", "MANGADON"],["MW.WEB-DL"],["NBLA.WEB-DL", "Nebula Proper ~ WEBDL"],["NF.WEB-DL", "NF WEB"],["OVEIL", "OV.WEB-DL", "OceanVeil"],["SHAHID"],["TVER"],["UNEXT"],["VIDIO"],["VIU"],["WETV"],["INSTA", "INSTAGRAM"],["ANIMENOTANE"],["TWTR"]];def SZf = ["ASW", "Judas", "JRx7", "EMBER", "GuodongSubs", "SAMEHADAKU"];def L_d = ["DB"];def n_ = ["Ruri-Saizen"];def hBj = ["Erai-raws", "SubsPlease"];def mXk = any {(fn =~ /^\[(.*?)\]/)[0][1]} {""};def QUL = any {def cF = wSN.find { HMt ->  HMt.find { alN ->  fn.lower().contains(alN.lower()) } }[0];cF = cF.replace(".WEB-DL", "");if (fn.contains("WEBRip")) {cF = cF.replace(".WEBRip", "");cF = cF + ".WEBRip"} else {cF = cF + ".WEB-DL"};cF} {source} {SZf.find { Tf ->  group == Tf || mXk == Tf } ? "WEBRip" : ""} {L_d.find { Tf ->  group == Tf || mXk == Tf } ? "BDRip" : ""} {n_.find { Tf ->  group == g__ || mXk == g__} ? "HDTVRip" : ""} {def BM = hBj.find { kdo ->  group == kdo || mXk == kdo} ? "WEB-DL" : "";(source == "Erai-raws" && vcf.upper() == "HEVC") ? "WEBRip" : BM} {vs} {""};QUL ? "$QUL " : ""}{def de = bitdepth ? " ${bitdepth}bit" : "";"$resolution $vcf $de, $ac"}{" "}{af.format(8: 'DD+ 7.1',7: '6.1',6: 'DD 5.1',5: '5.0',3: '2.1',2: '2.0',1: '1.0')}{def AcF = any { audioLanguages.size() } { 0 };def _c = AcF > 2 ? " MULTi-AUD" : AcF > 1 ? " DUAL-AUD" : "";def AU = AcF > 5 ? audioLanguages.take(5) : audioLanguages;def Ly = audioLanguages.any { it.ISO3B == language.ISO3B } ? "" : " DUBBED";_c = AcF == 1 && audioLanguages.any { it.ISO3B == "und" } ? "" : "$_c$Ly";_c}{def tu = text.language.collect {['zh-Hans': 'ZH-S','zh-Hant': 'ZH-T','ar-001': 'AR-MSA'].get(it,it).toUpperCase()}.unique();def oDz = any { tu.size() } { 0 };def _c = oDz > 2 ? ", MULTi" : oDz > 1 ? ", DUAL" : oDz == 1 ? ", SUB" : null;_c}{"]["}{crc32.upper()}{"]"}{if (f.subtitle) {def QG = ["name": "." + lang.name,"iso3b": "." + lang.ISO3B,"iso3": "." +lang.ISO3,"iso2": "." + lang.ISO2];def KU = subt;QG.values().each { YbS -> if (KU.contains(YbS)) {KU = KU.replace(YbS, "")}};QG.iso3b + KU}}{f.image ? "-thumb" : ""}