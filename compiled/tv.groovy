{def F_ = { System.getProperty(it) };def HL = F_("os.name").toLowerCase().contains("windows");def HD = F_("user.name");def pjQ = "/run/media/${HD}";def Bi = HL ? "H:/" : "$pjQ/Videos";def GJ_ = [[GK: "Books", Bd: "F:/", Xa: "$pjQ/Books"],[GK: "Data", Bd: "D:/", Xa: "$pjQ/Data"],[GK: "Games", Bd: "G:/", Xa: "$pjQ/Games"],[GK: "Music", Bd: "E:/", Xa: "$pjQ/Music"],[GK: "Videos", Bd: "H:/", Xa: "$pjQ/Videos"]];def PQ = (GJ_.collect { it[HL ? "Bd" : "Xa"] as File }.sort { KXV, QPw ->  KXV.exists() <=> QPw.exists() ?: KXV.diskSpace <=> QPw.diskSpace }).last();def Hly = Bi ?: PQ;"$Hly/"}{"Videos/"}{def SP = ["boys' love (bl)", "gay theme", "yaoi", "yuri", "lesbian", "hentai","sex", "lgbt", "explicit", "adult animation", "adult content","nudity", "animefesta"];def kt = "TheMovieDB::TV";def eG = [[ 74180, kt],[ 93821, kt],[ 95897, kt],[220118, kt],[249891, kt],[271026, kt]];def ccA = [[236530, kt]];def TKD = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def YW = TKD == "IMDb" ? "tt${id}" : id;def OUI = any { info.adult } { false };def Pol = eG.find { it[0] == YW && it[1] == TKD } != null;def wkN = ccA.find { it[0] == YW && it[1] == TKD } != null;def Dm = info.Keywords.findAll { it in SP } || Pol || OUI;Dm = wkN ? false : Dm;Dm ? "R18+ " : ""}{def dj = ["CN", "JP", "KR", "KP", "TW", "HK"];def uF = ["aeni", "donghua", "anime"];def UT = any {anime} || info.Keywords.findAll { it in uF } || (dj.contains(country) && genres =~ /Animation/);UT ? "Anime/" : "TV Series/"}{def kt = "TheMovieDB::TV";def Jk = [[njC: 213830, CCH: "I Was Reincarnated as the 7th Prince", Kl: kt],[njC: 236565, CCH: "Hero Without a Class", Kl: kt],[njC: 238460, CCH: "Sumikko Gurashi Sorairo no Mainichi Tokubetsu-hen", Kl: kt],[njC: 270660, CCH: "Pochars", Kl: kt],[njC: 277581, CCH: "Dekin no Mogura", Kl: kt],[njC: 280038, CCH: "Apocalypse Bringer Mynoghra", Kl: kt],[njC: 280405, CCH: "Fudanshi Shoukan", Kl: kt],[njC: 285260, CCH: "Kaijyu Sekai Seifuku", Kl: kt],[njC: 295625, CCH: "Marie Antoinette ni Tensei Shita", Kl: kt],[njC: 296047, CCH: "Shuukan Ranobe Anime", Kl: kt],[njC: 296319, CCH: "Tomica Heroes Job Labor (TV)", Kl: kt]];def TKD = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def YW = TKD == "IMDb" ? "tt${id}" : id;def wH = n;Jk.each {if (it.njC == YW && it.Kl == TKD) {wH = it.CCH}};def ot = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def rmY = wH.replaceAll(ot.collect { "\\" + it }.join('|'), '');rmY = rmY.replaceAll(/(\s|\.)*$/, '');rmY}{def kt = "TheMovieDB::TV";def uu = [[ 95897, kt],[123542, kt],[239779, kt],[257162, kt],[259140, kt],[276204, kt]];def tna = uu.find { it[0] == id && it[1] == info.database } != null;def IL = ["TheMovieDB::TV": "tmdbid","AniDB": "anidbid","TheTVDB": "tvdbid","TVmaze": "tvmazeid"];def zo = IL[info.database];tna ? " ($y) [${zo}-${id}]" : ""}{"/"}{episode.special ? 'Specials' : 'Season '+s}{def ot = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def rmY = sn.replaceAll(ot.collect { "\\" + it }.join('|'), '_');def AhZ = n.replaceAll(ot.collect { "\\" + it }.join('|'), '_');def Bpv = rmY.contains(AhZ) ? "" : rmY;Bpv == 'Season '+ s || Bpv == 'Series '+ s ? "" : Bpv ? " - " + Bpv : ""}{"/"}{def dcO = ["Alqanime","BlackLuster","darkflux","It's Anime","Kuramanime","NanDesuKa","ToonsHub","Tsundere-Raws","S1PH3R","Samehadaku"];def DF = dcO.find { fRx ->  fn.lower().contains(fRx.lower()) } ?: "";def SPy = any {DF} {(fn =~ /^\[(.*?)\]/)[0][1]} {group} {""};SPy ? "[$SPy] " : ""}{def kt = "TheMovieDB::TV";def Jk = [[njC: 213830, CCH: "I Was Reincarnated as the 7th Prince", Kl: kt],[njC: 236565, CCH: "Hero Without a Class", Kl: kt],[njC: 238460, CCH: "Sumikko Gurashi Sorairo no Mainichi Tokubetsu-hen", Kl: kt],[njC: 270660, CCH: "Pochars", Kl: kt],[njC: 277581, CCH: "Dekin no Mogura", Kl: kt],[njC: 280038, CCH: "Apocalypse Bringer Mynoghra", Kl: kt],[njC: 280405, CCH: "Fudanshi Shoukan", Kl: kt],[njC: 285260, CCH: "Kaijyu Sekai Seifuku", Kl: kt],[njC: 295625, CCH: "Marie Antoinette ni Tensei Shita", Kl: kt],[njC: 296047, CCH: "Shuukan Ranobe Anime", Kl: kt],[njC: 296319, CCH: "Tomica Heroes Job Labor (TV)", Kl: kt]];def TKD = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def YW = TKD == "IMDb" ? "tt${id}" : id;def wH = n;Jk.each {if (it.njC == YW && it.Kl == TKD) {wH = it.CCH}};def ot = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def rmY = wH.replaceAll(ot.collect { "\\" + it }.join('|'), '');rmY = rmY.replaceAll(/(\s|\.)*$/, '');rmY}{" - "}{s00e00}{def Od = (fn =~ /(?i)(?<![a-zA-Z])v(\d+)/);Od ? 'v' + Od[0][1] : ''}{def ot = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def rmY = t.replaceAll(ot.collect { "\\" + it }.join('|'), '_');rmY = rmY.length() > 100 ? " " : " - $rmY ";def EaD = any { e } { special };def eei = "Episode $EaD";def Qn = rmY.contains(eei) ? '' : rmY;special ? Qn : ''}{" ["}{def TZ = [["YTB", "YT.WEB-DL", "YOUTUBE"],["ABEMA", "ABEMATV"],["ADN"],["BILI", "B-Global", "BiliIntl"],["BSITE", "BILICN"],["BUMP"],["CMIC", "COOLMIC"],["CTHP"],["FOD"],["HIDIVE", "HIDI.WEB-DL"],["IQIYI", "IQ.WEB-DL"],["JFFP"],["LFTL", "LAFTEL"],["MDON", "MANGADON"],["MW.WEB-DL"],["NF.WEB-DL", "NF WEB"],["OVEIL", "OV.WEB-DL", "OceanVeil"],["SHAHID"],["TVER"],["UNEXT"],["VIDIO"],["VIU"],["WETV"],["INSTA", "INSTAGRAM"],["ANIMENOTANE"],["TWTR"]];def pFV = ["ASW", "Judas", "JRx7", "EMBER", "GuodongSubs", "SAMEHADAKU"];def Ias = ["DB"];def zK = ["Ruri-Saizen"];def rj = ["Erai-raws", "SubsPlease"];def sp = any {(fn =~ /^\[(.*?)\]/)[0][1]} {""};def nf = any {def TF = TZ.find { ej ->  ej.find { sv ->  fn.lower().contains(sv.lower()) } }[0];TF = TF.replace(".WEB-DL", "");if (fn.contains("WEBRip")) {TF = TF.replace(".WEBRip", "");TF = TF + ".WEBRip"} else {TF = TF + ".WEB-DL"};TF} {source} {pFV.find { bG ->  group == bG || sp == bG } ? "WEBRip" : ""} {Ias.find { bG ->  group == bG || sp == bG } ? "BDRip" : ""} {zK.find { bG ->  group == g__ || sp == g__} ? "HDTVRip" : ""} {def IG = rj.find { CK ->  group == CK || sp == CK} ? "WEB-DL" : "";(source == "Erai-raws" && vcf.upper() == "HEVC") ? "WEBRip" : IG} {vs} {""};nf ? "$nf " : ""}{def vi = bitdepth ? " ${bitdepth}bit" : "";"$resolution $vcf $vi, $ac"}{" "}{af.format(8: 'DD+ 7.1',7: '6.1',6: 'DD 5.1',5: '5.0',3: '2.1',2: '2.0',1: '1.0')}{def Gr = any { audioLanguages.size() } { 0 };def Xck = Gr > 2 ? " MULTi-AUD" : Gr > 1 ? " DUAL-AUD" : "";def qFZ = Gr > 5 ? audioLanguages.take(5) : audioLanguages;def XBD = audioLanguages.any { it.ISO3B == language.ISO3B } ? "" : " DUBBED";Xck = Gr == 1 && audioLanguages.any { it.ISO3B == "und" } ? "" : "$Xck$XBD";Xck}{def wa = text.language.collect {['zh-Hans': 'ZH-S','zh-Hant': 'ZH-T','ar-001': 'AR-MSA'].get(it,it).toUpperCase()}.unique();def NV = any { wa.size() } { 0 };def Xck = NV > 2 ? ", MULTi" : NV > 1 ? ", DUAL" : NV == 1 ? ", SUB" : null;Xck}{"]["}{crc32.upper()}{"]"}{if (f.subtitle) {def vEi = ["name": "." + lang.name,"iso3b": "." + lang.ISO3B,"iso3": "." +lang.ISO3,"iso2": "." + lang.ISO2];def ty = subt;vEi.values().each { Kvh -> if (ty.contains(Kvh)) {ty = ty.replace(Kvh, "")}};vEi.iso3b + ty}}{f.image ? "-thumb" : ""}