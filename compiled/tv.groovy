{def ehU = { System.getProperty(it) };def Tq = ehU("os.name").toLowerCase().contains("windows");def nJ = ehU("user.name");def Yfm = "/run/media/${nJ}";def jcg = Tq ? "H:/" : "$Yfm/Videos";def JNQ = [[_B: "Books", xTD: "F:/", kp: "$Yfm/Books"],[_B: "Data", xTD: "D:/", kp: "$Yfm/Data"],[_B: "Games", xTD: "G:/", kp: "$Yfm/Games"],[_B: "Music", xTD: "E:/", kp: "$Yfm/Music"],[_B: "Videos", xTD: "H:/", kp: "$Yfm/Videos"]];def TDg = (JNQ.collect { it[Tq ? "xTD" : "kp"] as File }.sort { KJg, zK ->  KJg.exists() <=> zK.exists() ?: KJg.diskSpace <=> zK.diskSpace }).last();def uqJ = jcg ?: TDg;"$uqJ/"}{"Videos/"}{def zth = ["boys' love (bl)", "gay theme", "yaoi", "yuri", "lesbian", "hentai","sex", "lgbt", "explicit", "adult animation", "adult content","nudity", "animefesta"];def CC = "TheMovieDB::TV";def RyS = [[ 74180, CC],[ 93821, CC],[ 95897, CC],[220118, CC],[249891, CC],[271026, CC]];def IbL = [[236530, CC]];def Poq = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def GL = Poq == "IMDb" ? "tt${id}" : id;def Rq = any { info.adult } { false };def iA = RyS.find { it[0] == GL && it[1] == Poq } != null;def KyE = IbL.find { it[0] == GL && it[1] == Poq } != null;def LM = info.Keywords.findAll { it in zth } || iA || Rq;LM = KyE ? false : LM;LM ? "R18+ " : ""}{def aV = ["CN", "JP", "KR", "KP", "TW", "HK"];def wh = ["aeni", "donghua", "anime"];def co = any {anime} || info.Keywords.findAll { it in wh } || (aV.contains(country) && genres =~ /Animation/);co ? "Anime/" : "TV Series/"}{def CC = "TheMovieDB::TV";def KaH = [[xZm: 199928, WJo: "Nights With a Cat", BA: CC],[xZm: 213830, WJo: "I Was Reincarnated as the 7th Prince", BA: CC],[xZm: 216489, WJo: "Tomica Heroes Job Labor (TV)", BA: CC],[xZm: 232230, WJo: "Lord of the Mysteries", BA: CC],[xZm: 238460, WJo: "Sumikko Gurashi Sorairo no Mainichi Tokubetsu-hen", BA: CC],[xZm: 248707, WJo: "Neko Oji The Guy That Got Reincarnated As a Cat", BA: CC],[xZm: 270660, WJo: "Pochars", BA: CC],[xZm: 277581, WJo: "Dekin no Mogura", BA: CC],[xZm: 280038, WJo: "Apocalypse Bringer Mynoghra", BA: CC],[xZm: 280405, WJo: "Fudanshi Shoukan", BA: CC],[xZm: 283884, WJo: "Chuhai Lips", BA: CC],[xZm: 288404, WJo: "The New Chronicles of Extraordinary Beings Preface", BA: CC],[xZm: 288419, WJo: "Chikuwa Senki", BA: CC],[xZm: 295625, WJo: "Marie Antoinette ni Tensei Shita", BA: CC]];def Poq = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def GL = Poq == "IMDb" ? "tt${id}" : id;def Yp = n;KaH.each {if (it.xZm == GL && it.BA == Poq) {Yp = it.WJo}};def DT = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def QX = Yp.replaceAll(DT.collect { "\\" + it }.join('|'), '');QX = QX.replaceAll(/(\s|\.)*$/, '');QX}{def CC = "TheMovieDB::TV";def dT = [[ 95897, CC],[123542, CC],[239779, CC],[257162, CC],[259140, CC],[276204, CC]];def pOd = dT.find { it[0] == id && it[1] == info.database } != null;def Ck = ["TheMovieDB::TV": "tmdbid","AniDB": "anidbid","TheTVDB": "tvdbid","TVmaze": "tvmazeid"];def kYt = Ck[info.database];pOd ? " ($y) [${kYt}-${id}]" : ""}{"/"}{episode.special ? 'Specials' : 'Season '+s}{def DT = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def QX = sn.replaceAll(DT.collect { "\\" + it }.join('|'), '_');def iV = n.replaceAll(DT.collect { "\\" + it }.join('|'), '_');def fK = QX.contains(iV) ? "" : QX;fK == 'Season '+ s || fK == 'Series '+ s ? "" : fK ? " - " + fK : ""}{"/"}{def VvB = ["Alqanime","BlackLuster","darkflux","It's Anime","Kuramanime","NanDesuKa","ToonsHub","Tsundere-Raws","S1PH3R","Samehadaku"];def LH = VvB.find { VlC ->  fn.lower().contains(VlC.lower()) } ?: "";def TwA = any {LH} {(fn =~ /^\[(.*?)\]/)[0][1]} {group} {""};TwA ? "[$TwA] " : ""}{def CC = "TheMovieDB::TV";def KaH = [[xZm: 199928, WJo: "Nights With a Cat", BA: CC],[xZm: 213830, WJo: "I Was Reincarnated as the 7th Prince", BA: CC],[xZm: 216489, WJo: "Tomica Heroes Job Labor (TV)", BA: CC],[xZm: 232230, WJo: "Lord of the Mysteries", BA: CC],[xZm: 238460, WJo: "Sumikko Gurashi Sorairo no Mainichi Tokubetsu-hen", BA: CC],[xZm: 248707, WJo: "Neko Oji The Guy That Got Reincarnated As a Cat", BA: CC],[xZm: 270660, WJo: "Pochars", BA: CC],[xZm: 277581, WJo: "Dekin no Mogura", BA: CC],[xZm: 280038, WJo: "Apocalypse Bringer Mynoghra", BA: CC],[xZm: 280405, WJo: "Fudanshi Shoukan", BA: CC],[xZm: 283884, WJo: "Chuhai Lips", BA: CC],[xZm: 288404, WJo: "The New Chronicles of Extraordinary Beings Preface", BA: CC],[xZm: 288419, WJo: "Chikuwa Senki", BA: CC],[xZm: 295625, WJo: "Marie Antoinette ni Tensei Shita", BA: CC]];def Poq = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def GL = Poq == "IMDb" ? "tt${id}" : id;def Yp = n;KaH.each {if (it.xZm == GL && it.BA == Poq) {Yp = it.WJo}};def DT = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def QX = Yp.replaceAll(DT.collect { "\\" + it }.join('|'), '');QX = QX.replaceAll(/(\s|\.)*$/, '');QX}{" - "}{s00e00}{def DT = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def QX = t.replaceAll(DT.collect { "\\" + it }.join('|'), '_');QX = QX.length() > 100 ? " " : " - $QX ";def RIV = any { e } { special };def fon = "Episode $RIV";def vX = QX.contains(fon) ? '' : QX;''}{" ["}{def IeR = [["YTB", "YT.WEB-DL", "YOUTUBE"],["ABEMA", "ABEMATV"],["ADN"],["BILI", "B-Global", "BiliIntl"],["BSITE", "BILICN"],["CMIC", "COOLMIC"],["CTHP"],["FOD"],["HIDIVE", "HIDI.WEB-DL"],["IQIYI", "IQ.WEB-DL"],["JFFP"],["LFTL", "LAFTEL"],["MDON", "MANGADON"],["MW.WEB-DL"],["NF.WEB-DL", "NF WEB"],["OVEIL", "OV.WEB-DL", "OceanVeil"],["SHAHID"],["TVER"],["UNEXT"],["VIDIO"],["VIU"],["WETV"],["INSTA", "INSTAGRAM"],["ANIMENOTANE"]];def xca = ["ASW", "Judas", "JRx7", "EMBER", "GuodongSubs", "SAMEHADAKU"];def umf = ["DB"];def WA = ["Ruri-Saizen"];def Cr = ["Erai-raws", "SubsPlease"];def DIA = any {(fn =~ /^\[(.*?)\]/)[0][1]} {""};def Vtc = any {def Ptb = IeR.find { pfF ->  pfF.find { qr ->  fn.lower().contains(qr.lower()) } }[0];Ptb = Ptb.replace(".WEB-DL", "");if (fn.contains("WEBRip")) {Ptb = Ptb.replace(".WEBRip", "");Ptb = Ptb + ".WEBRip"} else {Ptb = Ptb + ".WEB-DL"};Ptb} {source} {xca.find { MI ->  group == MI || DIA == MI } ? "WEBRip" : ""} {umf.find { MI ->  group == MI || DIA == MI } ? "BDRip" : ""} {WA.find { MI ->  group == g__ || DIA == g__} ? "HDTVRip" : ""} {def KDS = Cr.find { xio ->  group == xio || DIA == xio} ? "WEB-DL" : "";(source == "Erai-raws" && vcf.upper() == "HEVC") ? "WEBRip" : KDS} {vs} {""};Vtc ? "$Vtc " : ""}{def mvG = bitdepth ? " ${bitdepth}bit" : "";"$resolution $vcf $mvG, $ac"}{" "}{af.format(8: 'DD+ 7.1',7: '6.1',6: 'DD 5.1',5: '5.0',3: '2.1',2: '2.0',1: '1.0')}{def zk = any { audioLanguages.size() } { 0 };def zY = zk > 2 ? " MULTi-AUD" : zk > 1 ? " DUAL-AUD" : "";def TSx = zk > 5 ? audioLanguages.take(5) : audioLanguages;def hn = audioLanguages.any { it.ISO3B == language.ISO3B } ? "" : " DUBBED";zY = zk == 1 && audioLanguages.any { it.ISO3B == "und" } ? "" : "$zY$hn";zY}{def DbN = text.language.collect {['zh-Hans': 'ZH-S','zh-Hant': 'ZH-T','ar-001': 'AR-MSA'].get(it,it).toUpperCase()}.unique();def av = any { DbN.size() } { 0 };def zY = av > 2 ? ", MULTi" : av > 1 ? ", DUAL" : av == 1 ? ", SUB" : null;def TSx = av > 5 ? DbN.take(5) : DbN;zY}{"]["}{crc32.upper()}{"]"}{if (f.subtitle) {def yj = ["name": "." + lang.name,"iso3b": "." + lang.ISO3B,"iso3": "." +lang.ISO3,"iso2": "." + lang.ISO2];def VD = subt;yj.values().each { ZDI -> if (VD.contains(ZDI)) {VD = VD.replace(ZDI, "")}};yj.iso3b + VD}}{f.image ? "-thumb" : ""}